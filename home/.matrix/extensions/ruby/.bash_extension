function bundler_check() {

  command -v bundle >/dev/null 2>&1

  if [ $? -eq 1 ]; then
    echo -e "${YELLOW} Bundle gem is missing. Run: 'sudo gem install bundler' ${NORMAL}"
    echo -e "${YELLOW} Run: 'cd ~/.matrix/ruby/ && sudo bundle install' ${NORMAL}"
  else
    [ -f ~/.matrix/ruby/Gemfile.lock ] || echo -e "${YELLOW} GemFile not reconciled. Run: 'cd ~/.matrix/ruby/ && sudo bundle install' ${NORMAL}"
  fi

}

export PATH="$PATH:$HOME/.rvm/bin"                                   # Add RVM to PATH for scripting
[[ -s "$HOME/.rvm/scripts/rvm" ]] && source "$HOME/.rvm/scripts/rvm" # Load RVM into a shell session *as a function*

if [ -n "$matrix_skip_checks" ]; then
  command -v ruby >/dev/null 2>&1
  if [ $? -eq 1 ]; then
    echo -e "${RED}[WARNING] No Ruby Found. ${NORMAL}" >&2
  else
    if [ "$(type -t rvm)" == "function" ]; then
      echo -ne "${GREEN}RVM is present => ${NORMAL} "
      rvm gemdir
      ruby --version
      bundler_check
    else
      echo -e "${YELLOW}RVM is not present. ${NORMAL}"
      ruby --version
      bundler_check
    fi
  fi
fi
